<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="styles.css">
  <meta charset="UTF-8">
  <title>Electron Bowl!</title>
</head>

<body>
  <div id="top-bar" style="background-color:#495679;">
    <div class="score-box">
      <p class="box-header">SCORE</p>
      <p id="score-text">0</p>
    </div>
    <div class="downs-box">
      <p class="box-header">DOWNS</p>
      <p id="downs-text">1st and 10</p>
    </div>
    <div class="time-box">
      <p class="box-header">TIME</p>
      <p id="time-text">60</p>
    </div>
  </div>

  <div class="row">
    <div id="field-container">

    </div>
  </div>

  <div id="start-button" onclick="startGame()">
    START
  </div>

  <script>
    const GameManager = require('./js/game_manager.js')
    var gameManager = new GameManager() // most other js files will need this declared before they can be required and used
    require('./js/_renderer.js');
    const Player = require('./js/player.js');


    var isStarted = false;
    var isPaused = false;


    var player = new Player()

    // TODO: move out of index.html...
    function startGame() {
      // Clear any tombstones from previous game
      gameManager.refereeTombstones = []
      while (document.getElementsByClassName('referee-tombstone-sprite')[0]) {
        document.getElementsByClassName('referee-tombstone-sprite')[0].remove();
      }

      // layout some initial tombstones 'n such
      gameManager.setRefereeTombstones();

      // set onkeydown to player's move function
      document.onkeydown = player.move;

      isStarted = true;
      var count = 60;
      player.set();
      player.playerScore = 0;
      document.getElementById('score-text').innerHTML = player.playerScore;

      // Update the count down every 1 second if not paused
      var x = setInterval(function () {
        if (!isPaused) {
          count--;
        }

        // Display the time
        document.getElementById("time-text").innerHTML = count;

        // If the count down is finished, end game
        if (count < 0) {
          clearInterval(x);
          document.getElementById('start-button').style.display = 'block';
          document.getElementById('time-text').innerHTML = 'EXPIRED';
          isStarted = false;
          isPaused = false;
          document.onkeydown = null;
        }
      }, 1000);

      document.getElementById('start-button').style.display = 'none';
    }

  </script>
  <script>
    // TODO: remove, for testing only
    document.addEventListener("keydown", function (e) {
      if (e.which === 82) {
        location.reload();
      }
    });
  </script>

</html>